# Prediction Interval Competition II ‚Äì House Price

## –û —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏ Prediction Interval Competition II: House Price

- –í —ç—Ç–æ–º —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏ –Ω–∞ Kaggle —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –Ω—É–∂–Ω–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏ –¥–æ–º–∞, –∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π (prediction intervals), –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ —É–∂–µ, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –ø–æ–∫—Ä—ã–≤–∞—Ç—å –∏—Å—Ç–∏–Ω–Ω—É—é —Ü–µ–Ω—É –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 90‚ÄØ% —Å–ª—É—á–∞–µ–≤ 
–ú–µ—Ç—Ä–∏–∫–∞ –æ—Ü–µ–Ω–∫–∏ ‚Äî —Å—Ä–µ–¥–Ω–∏–π Winkler Interval Score:

- –ï—Å–ª–∏ –∏—Å—Ç–∏–Ω–Ω–∞—è —Ü–µ–Ω–∞ –ø–æ–ø–∞–ª–∞ –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª ‚Äì score = —à–∏—Ä–∏–Ω–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (upper¬†‚àí¬†lower);

- –ï—Å–ª–∏ –Ω–µ –ø–æ–ø–∞–ª–∞ ‚Äì –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —à—Ç—Ä–∞—Ñ, –æ–±—Ä–∞—Ç–Ω–æ–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–Ω—é –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏ Œ± = 0.1.

- –ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç —Ü–∏—Ñ—Ä–æ–≤—ã–µ –∫–Ω–∏–≥–∏ –∏ –∫—É—Ä—Å—ã –Ω–∞ —Ç–µ–º—ã CatBoost, —É—Ç–æ—á–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π —Å conformal prediction –∏ –¥—Ä. –∑–∞ –ª—É—á—à–µ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ CatBoost + conformal prediction –∏ —Ç.–ø

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π pipeline –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –¥–æ–≤–µ—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ —Ü–µ–Ω –¥–æ–º–æ–≤:

- 1. clearing_missing_values(df)
–£–¥–∞–ª—è–µ—Ç –≤—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –¢–∞–∫–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç id –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω–¥–µ–∫—Å–∞, –ø—Ä–æ–≤–µ—Ä—è—è –µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å.

- 2. create_peirs_of_feature(df)
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ ‚Äî –ø–æ–ø–∞—Ä–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∞–∂–Ω—ã—Ö —á–∏—Å–ª–æ–≤—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ sqft, land_val, beds, imp_val, grade, –∏ –¥—Ä. –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏.

- 3. add_date_features(df)
–†–∞–±–æ—Ç–∞–µ—Ç —Å –¥–∞—Ç–æ–π –ø—Ä–æ–¥–∞–∂–∏:

–ò–∑–≤–ª–µ–∫–∞–µ—Ç sale_year, sale_month;

–î–æ–±–∞–≤–ª—è–µ—Ç —Å–∏–Ω—É—Å/–∫–æ—Å–∏–Ω—É—Å-—Ñ–∏—á–∏ –¥–ª—è —Ü–∏–∫–ª–∏—á–Ω–æ—Å—Ç–∏ –º–µ—Å—è—Ü–∞;

–°—á–∏—Ç–∞–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç –¥–æ–º–∞ –∏ –≥–æ–¥—ã –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–µ–Ω–æ–≤–∞—Ü–∏–∏;

–£–¥–∞–ª—è–µ—Ç sale_date –∫–∞–∫ –Ω–µ–Ω—É–∂–Ω—ã–π.

- 4. new_features(df)
–°–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:

total_bath –∫–∞–∫ –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤–∞–Ω–Ω—ã—Ö;

total_view, garage_ratio, structure_share;

–û—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –≤–∞–Ω–Ω–∞–º–∏ –∏ —Å–ø–∞–ª—å–Ω—è–º–∏;

–ë–∏–Ω–∞—Ä–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã: –µ—Å—Ç—å –ª–∏ –ø–æ–¥–≤–∞–ª, –≥–∞—Ä–∞–∂, —Ä–µ–Ω–æ–≤–∞—Ü–∏—è, –≤–∏–¥;

–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–∏–∑–Ω–∞–∫ condition_grade –∏ total_area.

- 5. log_transform_features(df, flag_train=False)
–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º, –∏–Ω—Ç–µ—Ä–∞–∫—Ü–∏–∏ –º–µ–∂–¥—É –≤–∞–∂–Ω—ã–º–∏ —á–∏—Å–ª–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏), —á—Ç–æ–±—ã:

–°–≥–ª–∞–¥–∏—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤;

–£–º–µ–Ω—å—à–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ –≤—ã–±—Ä–æ—Å–æ–≤;

–£–ª—É—á—à–∏—Ç—å –æ–±–æ–±—â–∞—é—â—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏.

–ü–µ—Ä–µ—á–µ–Ω—å –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è flag_train:

–î–ª—è –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–∏ –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ interaction-—Ñ–∏—á–∏, —Ç–∞–∫ –∏ –±–∞–∑–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (sale_price, land_val, imp_val, –∏ —Ç.–ø.);

–î–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–∏ ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ –ø—Ä–∏–∑–Ω–∞–∫–∏, —á—Ç–æ –ø—Ä–æ—à–ª–∏ –æ—Ç–±–æ—Ä –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏.

- 6. remove_outliers_iqr(...)
–§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—ã–±—Ä–æ—Å–æ–≤ –∏–∑ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏:

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–∏–Ω –∏–∑ –º–µ—Ç–æ–¥–æ–≤: z-score –∏–ª–∏ IQR (–º–µ–∂–∫–≤–∞—Ä—Ç–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–∞—Ö);

–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ —Ç–æ–ø-N –ø—Ä–∏–∑–Ω–∞–∫–∞–º, –Ω–∞–∏–±–æ–ª–µ–µ –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å sale_price;

–£–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞–±–ª—é–¥–∞—é—Ç—Å—è –≤—ã–±—Ä–æ—Å—ã –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2+) –≤–∞–∂–Ω—ã–º –ø—Ä–∏–∑–Ω–∞–∫–∞–º.

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

method: —Å–ø–æ—Å–æ–± –æ—Ü–µ–Ω–∫–∏ (zscore –∏–ª–∏ iqr);

z_thresh: –ø–æ—Ä–æ–≥ –¥–ª—è zscore;

iqr_factor: –º–Ω–æ–∂–∏—Ç–µ–ª—å –¥–ª—è –≥—Ä–∞–Ω–∏—Ü –ø–æ IQR;

top_n: —á–∏—Å–ª–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏;

max_outlier_features: —Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–±—Ä–æ—Å–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ, —á—Ç–æ–±—ã —Å—Ç—Ä–æ–∫–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞.

- 7. target_encode_all(train_df, val_df, test_df, target_col="sale_price", n_splits=5)
–§—É–Ω–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–π target encoding –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Ç–µ—á–∫—É –¥–∞–Ω–Ω—ã—Ö (data leakage) –∏ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è —Ä–µ–¥–∫–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π.

üîß –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ ‚Äî –≤—Å–µ object-—Ç–∏–ø—ã, –∫—Ä–æ–º–µ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.

–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã —É –≤—Å–µ—Ö –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–æ–≤ ‚Äî –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –ø–æ –ø–æ–∑–∏—Ü–∏—è–º.

–ü–æ –∫–∞–∂–¥–æ–º—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É:

–†–∞–∑–±–∏–≤–∞–µ—Ç train_df –Ω–∞ n_splits —Ñ–æ–ª–¥–æ–≤.

–î–ª—è –∫–∞–∂–¥–æ–π —Ñ–æ–ª–¥—ã:

–°—á–∏—Ç–∞–µ—Ç —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ sale_price –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–Ω–∞ train-—á–∞—Å—Ç–∏ —Ñ–æ–ª–¥–∞).

–ü—Ä–∏–º–µ–Ω—è–µ—Ç .map() –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—É—é —á–∞—Å—Ç—å —Ñ–æ–ª–¥–∞.

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç OOF-–ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –≤ –≤–∏–¥–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–∑–Ω–∞–∫–∞ col_te.

–ü—Ä–∏–º–µ–Ω—è–µ—Ç .map() –∫–æ –≤—Å–µ–º—É val_df –∏ test_df ‚Äî –±–µ–∑ –∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏, –ø—Ä–æ—Å—Ç–æ –º–∞–ø–ø–∏–Ω–≥–æ–º –ø–æ train-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ.

–£–¥–∞–ª—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (object) –∏ –∫–æ–ª–æ–Ω–∫—É sale_price (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥–ª–∏–Ω—ã –¥–∞—Ç–∞—Ñ—Ä–µ–π–º–æ–≤ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å.

## –ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è LightGBM:

–ø–µ—Ä–≤–∞—è –º–æ–¥–µ–ª—å (mean_model) –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–≥–∞—Ä–∏—Ñ–º —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã (mu);

–≤—Ç–æ—Ä–∞—è –º–æ–¥–µ–ª—å (sigma_model) –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç –ª–æ–≥–∞—Ä–∏—Ñ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è (sigma).

–ù–∞ —ç—Ç–∞–ø–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è:

–º–æ–¥–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è mu –∏ sigma –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Ü–µ–Ω —á–µ—Ä–µ–∑ expm1;

## –§–∏–Ω–∞–ª—å–Ω—ã–π output

–°–æ–±–∏—Ä–∞–µ—Ç—Å—è DataFrame –¥–ª—è submission.csv, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:

id ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞;

pi_lower ‚Äî –Ω–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞;

pi_upper ‚Äî –≤–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞.

–§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –≥–æ—Ç–æ–≤ –∫ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞ Kaggle.